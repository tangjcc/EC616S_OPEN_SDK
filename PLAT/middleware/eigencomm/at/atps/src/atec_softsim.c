/*******************************************************************************(C) Copyright 2020 EIGENCOMM International Ltd.* All Rights Reserved*******************************************************************************  Filename:**  Description: esim AT commands interface function**  History:     09/22/2020  yjwang create*  Notes:    NULL*******************************************************************************/#ifdef SOFTSIM_FEATURE_ENABLE#include <stdlib.h>#include <string.h>#include "atc_decoder.h"#include "at_util.h"#include "cmicomm.h"#include "cms_comm.h"#include "cmisim.h"#include "cms_util.h"#include "atec_softsim.h"/**  \fn          esimSetSimChoiceStatus  \brief       at+esimswitch = 0/1  handle API  \param[in]   atHandle, val: setting value:0  or 1  \returns     CmsRetId*/CmsRetId esimSetSimChoiceStatus(UINT32 atHandle, UINT8         parVal){    CmsRetId                    ret = CMS_RET_SUCC;    CmiSimSetSimSwitchStateReq  req;    memset(&req, 0, sizeof(req));    req.val = parVal;    CacCmiRequest((UINT16)atHandle, CAC_SIM, CMI_SIM_SET_SIM_SWITCH_STATE_REQ, sizeof(CmiSimSetSimSwitchStateReq), (UINT8 *)&req);    return ret;}/**  \fn          esimGetSimChoiceStatus  \brief       at+esimswitch? handle API  \param[in]   atHandle  \returns     CmsRetId*/CmsRetId esimGetSimChoiceStatus(UINT32 atHandle){    CmsRetId                    ret = CMS_RET_SUCC;    CmiSimGetSimSwitchStateReq  req;    memset(&req, 0, sizeof(req));    CacCmiRequest((UINT16)atHandle, CAC_SIM, CMI_SIM_GET_SIM_SWITCH_STATE_REQ, sizeof(CmiSimGetSimSwitchStateReq), (UINT8 *)&req);    return ret;}/**  \fn          esimSWITCH  \brief       at+esimswitch command handle API  \param[in]   const AtCmdInputContext *pAtCmdReq  \returns     CmsRetId*/CmsRetId esimSWITCH(const AtCmdInputContext *pAtCmdReq){    CmsRetId            ret         = CMS_FAIL;    UINT32              atHandle    = AT_SET_SRC_HANDLER(pAtCmdReq->tid, CMS_DEFAULT_SUB_AT_ID, pAtCmdReq->chanId);    UINT32              operaType   = (UINT32)pAtCmdReq->operaType;    AtParamValueCP      pParamList  = pAtCmdReq->pParamList;    INT32               parVal;    switch (operaType)    {        case AT_TEST_REQ:            /* AT+eSIMSWITCH=? */        {            ret = atcReply(atHandle, AT_RC_OK, 0, (CHAR *)"+ESIMSWITCH: (0,1)");            break;        }        case AT_READ_REQ:           /* AT+eSIMSWITCH? */        {            ret = esimGetSimChoiceStatus(atHandle);            break;        }        case AT_SET_REQ:              /* AT+eSIMSWITCH=*/        {            if( (atGetNumValue(pParamList, 0, &parVal, ATC_ESIMSWITCH_0_FUN_VAL_MIN, ATC_ESIMSWITCH_0_FUN_VAL_MAX,ATC_ESIMSWITCH_0_FUN_VAL_DEFAULT)) != AT_PARA_OK)            {                ret = atcReply(atHandle, AT_RC_CME_ERROR, CME_INCORRECT_PARAM, NULL);            }            ret = esimSetSimChoiceStatus(atHandle, (UINT8)parVal);            if (ret != CMS_RET_SUCC)            {                ret = atcReply(atHandle, AT_RC_CME_ERROR, CME_INCORRECT_PARAM, NULL);            }            break;        }        default:        {            ret = atcReply(atHandle, AT_RC_CME_ERROR, CME_EAP_METHOD_NOT_SUPPORT, NULL);            break;        }    }    return ret;}#endif